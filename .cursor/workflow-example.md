# Cursor 自动化构建和修复工作流示例

## 快速开始

### 场景 1: 自动写代码 → 构建 → 修复错误

#### 步骤 1: 在 Cursor 中写代码
```
你: "添加一个函数来验证用户密码，使用 DPAPI 加密"
```

#### 步骤 2: 提交并推送代码
```bash
# 在终端运行
git add -A
git commit -m "添加密码验证函数"
git push origin dev
```

#### 步骤 3: 在 Cursor 中检查构建状态

**方法一：直接检查工作流程运行（推荐）**
```
你: "列出 Build WinUnlock 工作流程的运行"
你: "获取最新工作流程运行的详情"
你: "下载最新工作流程运行的日志"
```

**方法二：通过 PR 检查**
```
你: "检查 winunlock 仓库中最新 PR 的构建状态"
```

如果没有 PR，先创建：
```
你: "创建一个从 dev 分支到 main 分支的 Pull Request，标题：添加密码验证功能"
```

#### 步骤 4: 如果构建失败，获取错误
```
你: "下载最新工作流程运行的日志"  # 直接获取完整日志
你: "获取工作流程运行 #123 的详情"  # 获取特定运行的详情
你: "列出状态为失败的工作流程运行"  # 查找失败的运行
```

#### 步骤 5: 自动修复
```
你: "根据这些构建错误修复代码：[粘贴错误信息]"
```

#### 步骤 6: 重复步骤 2-5 直到成功

---

### 场景 2: 使用 GitHub Copilot 自动修复

#### 分配 Copilot 到 Issue
```
你: "分配 Copilot 到 issue #123"
```

Copilot 会：
1. 分析 issue
2. 创建修复代码
3. 创建 Pull Request
4. 等待你的审查

#### 请求 Copilot 审查 PR
```
你: "请求 Copilot 审查 PR #123"
```

---

### 场景 3: 完整的自动化循环

在 Cursor 中，你可以这样对话：

```
你: "我要添加一个新功能，帮我写代码、提交、创建 PR、检查构建、如果有错误就修复"

AI: [帮你写代码]

你: "现在提交代码并创建 PR"

AI: [使用 GitHub MCP 创建 PR]

你: "检查构建状态"

AI: [检查 GitHub Actions 状态]

你: "如果有错误，帮我修复"

AI: [分析错误并修复代码]
```

---

## 常用 GitHub MCP 命令

### 工作流程（GitHub Actions）管理 ⭐

#### 列出和查看工作流程
- `"列出 winunlock 仓库的所有工作流程"`
- `"列出 Build WinUnlock 工作流程的运行"`
- `"列出状态为失败的工作流程运行"`
- `"列出分支为 dev 的工作流程运行"`

#### 获取运行详情和日志
- `"获取工作流程运行 #123 的详情"`
- `"下载工作流程运行 #123 的日志"`
- `"获取最新工作流程运行的详情"`
- `"下载最新工作流程运行的日志"`

### 检查构建状态（通过 PR）
- `"获取 PR #123 的状态"`
- `"检查 PR #123 的构建状态"`
- `"列出所有打开的 PR"`

### 查看错误和日志
- `"获取 PR #123 的 diff"`
- `"显示 PR #123 的审查评论"`
- `"获取 PR #123 的文件列表"`
- `"下载工作流程运行 #123 的日志"`  # 直接获取构建日志

### 创建/更新 PR
- `"创建一个从 dev 到 main 的 PR，标题：修复构建错误"`
- `"更新 PR #123 的描述"`
- `"合并 PR #123"`

### 搜索和分析
- `"搜索包含 'CredentialProvider' 的代码"`
- `"在 winunlock 仓库中搜索编译错误"`
- `"列出 winunlock 仓库的所有 issues"`

---

## 实际使用示例

### 示例 1: 修复编译错误

```
你: "我刚刚推送了代码，帮我检查构建状态"

AI: [使用 GitHub MCP Server]
"让我检查最新的工作流程运行..."

你: "列出 Build WinUnlock 工作流程的运行"

AI: [列出运行] "找到了最新的运行 #456，状态是失败"

你: "下载运行 #456 的日志"

AI: [下载日志] "构建失败了，错误是：缺少头文件 'credentialprovider.h'"

你: "帮我修复这个错误"

AI: [分析代码，添加缺失的头文件，修复代码]

你: "提交修复并推送"

AI: [提交并推送]

你: "再次检查构建状态"

AI: [检查最新运行] "✅ 构建成功！运行 #457 已完成"
```

### 示例 2: 添加新功能

```
你: "添加一个功能来检查密码强度"

AI: [写代码]

你: "创建 PR 并检查构建"

AI: [创建 PR，检查构建]
"PR #45 已创建，构建中..."

你: "构建完成了吗？"

AI: [检查] "构建成功！PR 已准备好合并。"
```

---

## 提示和技巧

1. **使用描述性的提交信息**：便于 AI 理解你的意图
2. **小步提交**：每次提交一个功能，便于定位问题
3. **及时检查**：推送后立即检查构建状态
4. **利用 AI 分析**：让 AI 分析错误并自动修复
5. **使用 Copilot**：对于复杂问题，让 Copilot 自动处理

---

## 故障排除

### 构建一直失败
```
你: "分析这个构建错误并修复：[粘贴完整错误日志]"
```

### 找不到 PR
```
你: "列出所有打开的 PR"
你: "创建从 dev 到 main 的 PR"
```

### MCP Server 无响应
- 检查 `~/.cursor/mcp.json` 配置
- 确认 GitHub PAT 有效
- 重启 Cursor

